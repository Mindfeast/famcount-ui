<div class="chart-container">
  @if(isChartReady) {
  <svg width="800px" height="800px">
    <g>
      <rect
        [attr.x]="padding.left"
        [attr.y]="padding.top"
        [attr.width]="width - padding.left - padding.right"
        [attr.height]="height - padding.top - padding.bottom"
        fill="#f5f5f5"
        stroke="#aaa"
        stroke-width="1"
      />
      <!-- X Ticks and Labels -->
      @for (x of xTicks; track x) {
      <g>
        <line
          [attr.x1]="xScaleValue(x)"
          [attr.y1]="padding.top"
          [attr.x2]="xScaleValue(x)"
          [attr.y2]="height - padding.bottom"
          stroke="#ccc"
          stroke-width="1"
        />
        <text
          [attr.x]="xScaleValue(x)"
          [attr.y]="height - padding.bottom + 12"
          font-size="10"
          text-anchor="middle"
          fill="#333"
        >
          {{ formatXLabel(x) }}
        </text>
      </g>
      } @for (x of xTicks; track x) {
      <g>
        <!-- Vertical grid line -->
        <line
          [attr.x1]="xScaleValue(x)"
          [attr.y1]="padding.top"
          [attr.x2]="xScaleValue(x)"
          [attr.y2]="height - padding.bottom"
          stroke="#ccc"
          stroke-width="0.5"
          stroke-dasharray="4,4"
          opacity="0.6"
        />
      </g>
      }
      <!-- Y Ticks and Labels -->
      @for (y of yTicks; track y) {
      <g>
        <line
          [attr.x1]="padding.left - 5"
          [attr.y1]="yScaleValue(y)"
          [attr.x2]="padding.left"
          [attr.y2]="yScaleValue(y)"
          stroke="#ccc"
          stroke-width="1"
        />
        <text
          [attr.x]="padding.left - 10"
          [attr.y]="yScaleValue(y) + 2"
          font-size="5"
          text-anchor="end"
          fill="#333"
        >
          {{ y }}
        </text>
        <!-- Horizontal grid line -->
        <line
          [attr.x1]="padding.left"
          [attr.y1]="yScaleValue(y)"
          [attr.x2]="width - padding.right"
          [attr.y2]="yScaleValue(y)"
          stroke="#ccc"
          stroke-width="0.5"
          stroke-dasharray="4,4"
          opacity="0.6"
        />
      </g>
      }
      <!-- Chart lines and points -->
      @for (serie of data.series; track $index) {
      <path
        [attr.d]="curvePath(sortPoints(serie.points))"
        fill="none"
        [attr.stroke]="getColor($index)"
        stroke-width="1.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        [class.chart-line]="hoveredPoint"
        opacity="0.6"
      />
      <svg:g
        app-bullet-point
        [points]="serie.points"
        [xScale]="xScale"
        [yScale]="yScale"
        [legend]="{ series: 'Year', value: 'Value' }"
        [color]="getColor($index)"
        (pointHover)="onHover($event)"
      ></svg:g>
      }
    </g>
  </svg>
  }
  <div class="legend-container">
    @for (serie of data.series; track $index) {
    <app-chart-legend
      [data]="serie"
      [color]="getColor($index)"
    ></app-chart-legend>
    }
  </div>
</div>
